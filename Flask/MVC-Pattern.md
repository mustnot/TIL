# MVC Pattern with Flask

> 내가 Flask로 프로젝트를 하면서 구조화에 많은 시간을 할애했는데, 사실 정확하게 어떠한 기준이 있어 그 기준으로 구조를 만들기보다는 나중에 유지보수할 때 어느 함수를 수정해야하고 어떤 부분을 고쳐야하는지 정확히 판단하기 위한게 가장 컸는데 이번에 MVC 패턴이라는 걸 알게되어서 정리해보자고함.

<br>

**MVC** (Model - View - Controller) 패턴이란, 소프트웨어 공학에서 사용되는 소프트웨어 디자인 패턴 중 하나로 세 가지 구성요소를 가진다. 먼저, **컨트롤러** (Controller)는 사용자의 입력처리와 흐름 제어를 담당한다. 클라이언트의 요청에 의해 모델에 명령을 보냄으로써 모델의 상태를 상태를 변경하는데 조이스틱의 컨트롤러와 비슷하다고 생각하면 되지 않을까 생각한다. 컨트롤러를 통해 어떠한 명령을 내리면 화면에 보여주는 결과물 여기서는 **뷰**가 변경되는 것과 유사하다고 생각한다.

<br>

**뷰**(View)는 사용자가 보게 될 결과 화면을 출력하는 역할을 하고 모델로부터 정보를 얻어와 이를 생성하여 보여준다. **컨트롤러**를 조이스틱에 비유했다면 **뷰**는 게임 화면을 예시로 생각하면 좋을 것 같다. 그럼 **모델** (Model)은 백그라운드에서 동작하는 로직을 처리하는데, **컨트롤러**의 요청에 의해 모델의 상태가 변화되어야한다면 이러한 로직을 수행하는 것이 **모델**이다. 그럼 모델은 게임에서 무엇과 비슷할까 생각해보면 게임 그 자체가 아닐까 생각한다. 게임 내부에서 캐릭터의 움직임 혹은 인벤토리의 아이템에 대한 것들까지 모든 부분을 포함한다고 하면 말이다

<br>

![image-20200724145350178](https://user-images.githubusercontent.com/52126612/88365478-21f04c80-cdc1-11ea-9dd0-1bdb7c595383.png)


<br>

(내가 이해한 대로 그려봤는데 맞는지 잘 모르겠다) 그림으로 보면서 느낀대로 말하자면, **뷰**는 단순히 화면을 통해 클라이언트에게 보여주는 역할만 수행하고 클라이언트는 **컨트롤러**를 이용해 특정 이벤트 혹은 행위를 요청하면 컨트롤러는 요청을 **모델**로 전달하여 모델에서는 백그라운드에서 클라이언트의 요청을 수행하게 된다. 이렇게 요청된 결과를 다시 **컨트롤러**를 통해 **뷰**로 전달하고 **뷰**는 이 결과를 화면을 통해 클라이언트에게 제공한다.

<br>

그럼 문제가 있다면 만약 **뷰** 화면의 디자인이 변경되거나 특정 부분이 수정된다면 관련된 **모델** 역시도 같이 변경되어야하는 문제가 있을 것 같고 그 반대의 경우도 있을 것 같다. 그래서 문제점이 무엇이 있나 봤더니, MVC 패턴의 문제 중 하나가 바로 **뷰와 모델이 서로 의존성을 띄게 된다** 라는 거였는데, 한 눈에 보기에 하나의 뷰와 하나의 모델이 의존하는 구조가 MVC 구조에선 가장 적합한 구조가 아닐까 생각되었다.

<br>

간단한 `Flask` 코드와 연관지어서 생각하기 위해 간단하게 코드를 작성했다.

```python
from flask import Flask

app = Flask(__name__)

@app.route('/controller/<string:name>')
def controller(name):
    if name == 'admin':
        rv = 'go to admin page'
    else:
        rv = 'hello user %s' % name
    return rv
```

<br>

먼저, 위 코드는 `/controller/admin` 으로 접속했을 때와 `/controller/{name}` 으로 접속 했을 때 각기 다른 텍스트를 리턴하는 코드인데 그럼 코드의 각 부분은 MVC에 어떠한 구성요소와 일치하는지 얘기해보면 다음과 같다.

* **Controller :** `app.route('/controller/<string:name>')` 
* **Model :** `controller(name)`
* **View :** `rv = 'go to admin page'` or `rv = 'hello user name'`



여기서도 문제점이 더 보이는데, 사실 이런 코드가 `Flask`의 가장 대표적인 예시 중 하나라서 이렇게 보일 수도 있지만 여러 `extension`을 잘 이용하면 이런 문제를 많이 해소할 수 있다. 그럼 문제가 무엇이냐면, 여기서도 **뷰**와 **모델**이 거의 한 몸으로 볼 수 있을 정도로 하나로 묶여있다는 것이다. 이 코드는 함수형 뷰 (FBV : Function Based View) 라서 그렇게 보일 수도 있어서 처음 배우시는 분들은 이것만 보고 음 플라스크는 이런 문제가 있네, 쓰면 안되겠다라는 생각은 안하셨으면 좋겠다. 이렇듯 **MVC** 패턴은 의존성 문제가 있어 이를 해결하기 위해서는 보다 발전된 디자인 패턴을 이용하는 것이 좋다. 

