## 테스트란

> 실제로 테스트 코드를 많이 짜본 경험이 없다. 업무를 하면서도 테스트가 중요하다는 것을 인지함에도 불구하고 시간이 없다는 핑계로 넘겨 많은 시행착오 끝에 완성된 코드가 대다수라는 점이 가끔은 부끄럽기도 했고, 어느 순간부터 테스트 코드를 작성해야겠다고 생각하고 작성하고 있는데 다시 한번 정리해야겠다고 생각되어서 정리한다.

<br>

우선 테스트란, 뭐 말 그대로 테스트이다. 코드가 있다면 Input에 대해 내가 원하는 Output이 정확하게 일치하는지를 확인하는 것일 수도 있고 어떠한 과정이 있다면, 코드에 그런 과정이 순차적으로 이어지고 특정 상황에서 문제가 발생하지 않은지 테스트하는 것을 말한다. 단순하게 설명하면 이러한데, 생각해보면 그리 단순한 문제는 아니다.

실제로 코드를 작성하다보면 굉장히 많은 시행착오를 겪는데, 예를 들어 사용자가 이메일을 등록하는 기능이 있다고 예를 들면, 옛날 같았으면 단순히 이메일 포맷만 맞다면 더이상 검사하지 않고 넘어갔을 것이다. 하지만, 이제는 이메일이라는게 단순히 고객이 등록할 수 있는 정보 중에 하나였다면, 이제는 계정으로도 사용되고 이메일이 서비스의 가장 중요한 일부분이 될 수 있어 많은 검증 로직이 필요하다.

```python
import re

def validate_email(email):
    expression = r'''^(?:(?:[\w`~!#$%^&*\-=+;:{}'|,?\/]+(?:(?:\.(?:"(?:\\?[\w`~!#$%^&*\-=+;:{}'|,?\/\.()<>\[\] @]|\\"|\\\\)*"|[\w`~!#$%^&*\-=+;:{}'|,?\/]+))*\.[\w`~!#$%^&*\-=+;:{}'|,?\/]+)?)|(?:"(?:\\?[\w`~!#$%^&*\-=+;:{}'|,?\/\.()<>\[\] @]|\\"|\\\\)+"))@(?:[a-zA-Z\d\-]+(?:\.[a-zA-Z\d\-]+)*|\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])$'''
    if re.search(expression, email):
        return True
    return False

```

<br>

위 코드는 간단하게 regex를 이용한 이메일 검증인데, 음 정규식을 하나 하나 뜯어서 설명하기에는 너무 복잡하니 문제점만 설명하면, 해당 이메일 정규식은 이메일 폼만 맞는다면 모두 승인된다. 예를 들어서 `admin@who.is.your.admin` 이렇게 `@` 뒤에 계속해서 도메인이 생기더라도 이메일 형식에 맞기 때문에 넘어가는데 좀 더 디테일하게 따져보면 `@` 뒤에는 주로 도메인이 많이 붙는데, `who.is.your.admin` 이러한 도메인이 과연 있을까라고 생각하면 분명하게 없다. 그 이유는 도메인 형식을 간단하게 말하면 `google.co.kr`을 예로 처음 `google`이 있고, 그 다음에 여기에서는 `co.kr`, `or.kr`, `go.kr` 같이 2개로 국가 혹은 기관을 의미하는 끝 주소와 혹은 `com`, `net`, `org` 와 같이 한 단어로 이루어졌다.

그러면 어떻게 디테일화 시키면 좋을까라고 생각하면 정규식이 디테일하지는 않지만 간단히 나마 작성하면 이렇게 작성할 것 같다. 사실 이것보다 더 자세하게 작성해야한다. [전자우편주소-wikipedia]([https://ko.wikipedia.org/wiki/%EC%A0%84%EC%9E%90_%EC%9A%B0%ED%8E%B8_%EC%A3%BC%EC%86%8C](https://ko.wikipedia.org/wiki/전자_우편_주소))에 작성된 내용을 읽어보면 `local` 부분에도 `@`가 들어갈 수 있기 때문에 추가적인 작업이 필요하다. (우선 간단한 코드 작성이니 경우 제외)

```python
DOMAIN_REGEX = "^[\w\d\-]+(\.[\w]{2,3})?\.[\w\d\-]+$"

def validate_email(email):
  local, domain = email.split('@')
  if re.search(DOMAIN_REGEX, domain):
    return True
  return False
```

<br>

> 간단하게 짠 코드더라도 그 의도와 예외를 고려하여 코드를 작성할 필요가 있다. 경험적인거지만 개발하기 전에 리서치를 최대한 많이 해보는게 좋다고 생각된다. 예를 들어 도메인에 대한 정규식을 찾더라도 수 많은 정규식이 나오고 이런 정규식 중에 서비스 혹은 기능에 가장 알맞는 정규식이 있을 수도 있고 없을 수 있다.

처음 이메일 검증 코드를 작성할 때에는 문제가 많았다. 예를 들면, `google.com` `aaa.com`과 같이 뒤에 하나의 TLD만 있는 케이스만 생각해서 개발했는데, 기능 테스트를 진행하다보니 많은 문제가 있었다. 예를 들면, `co.kr`을 인식하지 못해 이메일을 못 보낸다던가, 검증에서 계속 실패해서 다음 단계로 넘어가지 못하는 문제가 있었다. 사실 뭐가 문제인지 처음에는 알아차리지 못했다. (이 때부터인가.. 내가 정규식을 공부하게 된 시점이...) 아무튼 그래서 리서치를 본격적으로 시작했다.

리서치를 통해 어떠한 포맷이 정확한 이메일 형식이고 고객이 이 기능을 실행할 때에는 어떠한 이메일들이 주를 이뤄 들어오겠구나라는 생각과 만약 어뷰저, 이상한 유저들은 어떠한 이메일을 넣어서 문제를 일으킬 것인지 생각해봤다. 그러다보니 단순하게 볼 수 있는 이메일 검증 코드지만 굉장히 길어졌고, 이 때부터 점점 테스트의 중요성을 알았다.